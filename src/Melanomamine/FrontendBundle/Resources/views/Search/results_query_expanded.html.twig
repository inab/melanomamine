{% extends '::frontend.html.twig' %}
{% block title %}Listing Evidences {% endblock %}
{% block article %}
    {% include 'MelanomamineFrontendBundle:Search:tags_code.html.twig' %}
    {% set tooltipCounter=1 %}
    {% set stringStickyTooltip = "" %}

    <div id="evidences">
        {% if totalHits != 0 %}
            <div id="abstractsResults">
                <a name="abstracts"></a>
                <h3>Ranked Abstracts for "<span class="underline">{{ searchTerm }}</span>" {#  {{ entityType | capitalize }} search</h3> #}
                <div class="btmspc-dbl">
                    <small>
                        <em>
                            Entity mentions are highlighted as follows:
                            <mark class="termSearched">What you searched</mark>, <span class="genes_highlight">Genes</span>, <span class="mutations_highlight">Mutations</span>, <span class="chemicals_highlight">Chemicals</span>, <span class="diseases_highlight">Diseases</span>, <span class="mutatedProteins_highlight">Mutated Proteins</span>, , <span class="species_highlight">Species</span>
                        </em>
                        .
                    </small>
                </div>
                 <div class="results-summary">
                <table>
                    <tr>
                        <td><strong>Number of Abstracts displayed:</strong> {{ hitsShowed }}</td>
                    </tr>
                    <tr>
                        <td><strong>Query time:</strong> {{ totalTime }} ms.</td>
                    </tr>
                    <!--  {% if totalHits > 150 %}
                        <tr>
                            <td colspan="5"><strong>Number of Abstracts:</strong> {{ totalHits }}. (All above scores are for the {{hitsShowed}} displayed hits). <br/>Click here to display all results</td>
                        </tr>
                        {% endif %}
                    -->

                    {% if arrayAliases is defined %}
                        <tr>
                            <td colspan="5"><strong>Query Expansion Aliases:</strong> {{ arrayAliases | length }}</td>
                        </tr>
                        <tr>
                            <td colspan="5"><strong>Aliases:</strong> {{ arrayAliases | join(", ") }}</td>
                        </tr>
                    {% endif %}

                </table>
            </div>
                <div class="clear-both"></div>
                <table id="tableResults" class="tablesorter">
                    <thead>
                        <th>Pubmed Link</th>
                        <th>Score</th>
                        <th>Title</th>
                        <th>Abstract</th>
                    </thead>
                    <tbody>
                        {% set contador = 1 %}
                        {% for result in arrayResultsAbs %}
                            <tr class="document {{ cycle(['odd', 'even'], contador) }}">
                                {% set contador = contador + 1 %}
                                {% set source = result.getSource %}
                                {% set pmid = source["pmid"]  %}
                                {% set title = source["title"]  %}
                                {% set text = source["text"]  %}
                                {% set score = source["melanoma_score_new"] %}
                                {% set offset = title | length + 1%}
                                {% set imageRoute = 'images/pubmed.png' %}
                                {% set link="http://www.ncbi.nlm.nih.gov/pubmed/" ~ pmid %}

                                <td><a href="{{ link }}" target="_blank"><img src="{{ asset(imageRoute) }}" class="outlinkLogo"/></a></td>
                                <td class="center">{{ score }}</td>
                                {% set title = title | retrieveHighlighted (source, entityName, startOffset = 0, filter="title") %}
                                <td>{{ title | raw }}</td>
                                {% set text = text | retrieveHighlighted (source, searchTerm, offset, filter="text") %}
                                <td>{{ text | raw }}</td>
                            </tr>
                        {% endfor %}


                    </tbody>
                </table>
                <!-- here pagination block for abstracts -->
                <div class="pagination">
                {% if entityType == "genes" or entityType == "mutatedProteins" %}
                    {{ simple_paginator_render(
                        'search_' ~ entityType ~ '_expanded', 'abstracts',
                            {
                                'routeParams' : {'whatToSearch': "ncbiGeneId", 'entityName': entityName, 'specie': specie, 'searchTerm': searchTerm},
                                'container_class' : 'pagination'
                            }
                        )
                    }}
                {% endif %}
                </div>
            </div>
        {% endif %}
        {# Here we rebuild the stringStickyTooltip inside its container divs #}
        <div id="mystickytooltip" class="stickytooltip">
            <div style="padding:5px">
                {{ stringStickyTooltip | raw }}
            </div>
            <div class="stickystatus"></div>
        </div>
    {% include 'MelanomamineFrontendBundle:Search:scripts_code.html.twig' %}
{% endblock %}